---
title: Garnet hosting integration
description: Learn how to use the Garnet hosting integration to add a Garnet resource to your AppHost.
---

import InstallPackage from '@components/InstallPackage.astro';
import { Aside } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import garnetIcon from '@assets/icons/garnet-icon.png';

<Image
  src={garnetIcon}
  alt="Garnet logo"
  width={100}
  height={100}
  class:list={'float-inline-left icon'}
  data-zoom-off
/>

The Garnet hosting integration models a Garnet resource as the `GarnetResource` type. To access this type and APIs, add the [ðŸ“¦ Aspire.Hosting.Garnet](https://www.nuget.org/packages/Aspire.Hosting.Garnet) NuGet package in your AppHost project:

<InstallPackage packageName="Aspire.Hosting.Garnet" />

## Add Garnet resource

In your AppHost project, call `AddGarnet` on the builder instance to add a Garnet resource:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var cache = builder.AddGarnet("cache");

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(cache);
```

When Aspire adds a container image to the AppHost, it creates a new Garnet instance on your local machine.

<Aside type="tip">
  If you'd rather connect to an existing Garnet instance, call
  `AddConnectionString` instead. For more information on how to use
  `WithReference`, see [Resource dependencies](/get-started/resources/).
</Aside>

## Add Garnet resource with data volume

To add a data volume to the Garnet resource, call the `WithDataVolume` method:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var cache = builder.AddGarnet("cache")
                   .WithDataVolume(isReadOnly: false);

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(cache);
```

The data volume is used to persist the Garnet data outside the lifecycle of its container. The data volume is mounted at the `/data` path in the Garnet container.

## Add Garnet resource with data bind mount

To add a data bind mount to the Garnet resource, call the `WithDataBindMount` method:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var cache = builder.AddGarnet("cache")
                   .WithDataBindMount(
                       source: @"C:\Garnet\Data",
                       isReadOnly: false);

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(cache);
```

<Aside>
  Data bind mounts have limited functionality compared to volumes, and when you
  use a bind mount, a file or directory on the host machine is mounted into a
  container.
</Aside>

## Add Garnet resource with persistence

To add persistence to the Garnet resource, call the `WithPersistence` method with either the data volume or data bind mount:

```csharp title="C# â€” AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var cache = builder.AddGarnet("cache")
                   .WithDataVolume()
                   .WithPersistence(
                       interval: TimeSpan.FromMinutes(5),
                       keysChangedThreshold: 100);

var myService = builder.AddProject<Projects.ExampleProject>()
                       .WithReference(cache);
```

The preceding code adds persistence to the Garnet resource by taking snapshots of the data at a specified interval and threshold.

## Connection properties

When you reference a Garnet resource using `WithReference`, the following connection properties are made available to the consuming project:

### Garnet

The Garnet resource exposes the following connection properties:

| Property Name | Description                                                                         |
| ------------- | ----------------------------------------------------------------------------------- |
| `Host`        | The hostname or IP address of the Garnet server                                     |
| `Port`        | The port number the Garnet server is listening on                                   |
| `Password`    | The password for authentication (available when a password parameter is configured) |
| `Uri`         | The connection URI, with the format `redis://:{Password}@{Host}:{Port}`             |

**Example connection string:**

```
Uri: redis://:p%40ssw0rd1@localhost:6379
```

<Aside type="note">
  Aspire exposes each property as an environment variable named
  `[RESOURCE]_[PROPERTY]`. For instance, the `Uri` property of a resource called
  `cache` becomes `CACHE_URI`.
</Aside>

## Hosting integration health checks

The Garnet hosting integration automatically adds a health check for the Garnet resource. The health check verifies that the Garnet instance is running and that a connection can be established to it.
